var d=!0,e=!1,g=g||{},k=this;function l(a,b){var c=a.split("."),f=k;!(c[0]in f)&&f.execScript&&f.execScript("var "+c[0]);for(var h;c.length&&(h=c.shift());)!c.length&&void 0!==b?f[h]=b:f=f[h]?f[h]:f[h]={}};l("Napster",m);l("authentication",n);l("authentication.cookieAge",n.sa);l("authentication.token",n.H);l("authentication.userid",n.s);l("authentication.username",n.T);l("authentication.init",n.j);l("authentication.getUsername",n.$);l("authentication.hash",n.hash);l("authentication.login",n.da);l("authentication.logout",n.Ga);l("authentication.createUser",n.W);l("authentication.changePassword",n.V);l("closurequery",q);l("controllers",s);l("datastore",t);l("datastore.data",t.data);
l("datastore.root",t.root);l("datastore.group",t.group);l("datastore.lastPlayed",t.g);l("datastore.track",t.b);l("datastore.user",t.c);l("debug",u);l("debug.log",u.log);l("debug.logFoo",u.Ea);l("debug.logVal",u.Fa);l("debug.lucky",u.Ha);l("init",B);l("services",C);l("services.metadata",C.ea);l("services.search",C.search);l("services.stream",C.P);l("stream",D);l("stream.isPlaying",D.e);l("stream.newTime",D.h);l("stream.newTimeProcessed",D.Ia);l("stream.player",D.d);l("stream.syncTimeouts",D.Q);
l("stream.init",D.j);l("stream.isFinished",D.Ba);l("stream.length",D.length);l("stream.loadTrack",D.ca);l("stream.mute",D.fa);l("stream.onFinished",D.ha);l("stream.play",D.play);l("stream.processTime",D.O);l("stream.sync",D.na);l("stream.time",D.time);l("stream.updateNowPlaying",D.I);l("stream.volume",D.volume);l("ui",E);l("ui.pageLoadingClass",E.Ka);l("ui.playButtonClass",E.La);l("ui.slider",E.f);l("ui.init",E.j);l("ui.update",E.update);var D=new function(){var a=this;a.j=function(){function b(){}function c(a){(a=a.data==YT.qa.Za?window.ia:a.data==YT.qa.Xa?window.Ja:null)&&a();E.update()}function f(){var b=new g.async.Va(function(){return window.ua});b.Db=function(){a.ha()};b.start()}window.Eb=function(){a.d=new YT.$a(F("#stream")[0],{height:"390",width:"640",yb:"1",nb:{onReady:f,onStateChange:c,onError:b}})};t.c().z.e.ma(e);t.c().z.G.ma(0);a.Q=[]};a.Ba=function(){return a.time()>=a.length()};a.length=function(){return a.d.tb()};
a.ca=function(b,c,f){a.d.Qa();a.time(0,d);window.ia=function(){window.ia=null;window.setTimeout(function(){D.volume(0);a.time(0,d);a.play(d,d);t.b(a.m).length.set(a.length());c&&c()},2E3)};t.b(b).ja("value",function(c){var j=c.l();c=c.name();E.f.Lb(j.length);t.b(b).g.set(Date.now());t.b(b).M.set(n.s);t.g().push(c);a.d.Ab(j.p);a.m=b;f!=d&&(t.b(b).N.set(++j.N),a.I());c=t.data.c.X.i.B;for(var r in c)j=c[r],j.ga=j.id==a.m?"now-playing":""})};a.fa=function(b){b!=e?a.d.fa():a.d.Pb()};a.ha=function(b){window.Ja=
function(){a.play(e);window.clearInterval(E.f.la);b&&b()}};a.play=function(b,c){a.e=b==e?e:d;a.e?a.volume(100):a.volume(0);window.clearInterval(E.f.la);a.e&&(E.f.la=window.setInterval(function(){!E.f.oa&&a.e&&a.time()},500));a.e?a.d.Ma():a.d.ka();E.update();a.time();c!=d&&a.I()};a.O=function(a){a=a||0;return(60>a?"0:":"")+(10>a?"0":"")+([].add((new Date(0,0,0,0,0,a)).toLocaleTimeString().match(/[^0:].*/))[0]||0)};a.na=function(b){b=b||n.s;var c=t.c(b);t.c(t.data.c.X.Y).z.G.A();t.c().Y.set(b);c.z.G.o("value",
function(b){b=b.l();var h=(Date.now()-b)/1E3;c.k.ja("value",function(b){var c=b.l(),f=c.time+(c.e?h:0);c.b!=a.m?a.ca(c.b,function(){a.Q[0]=window.setTimeout(function(){c.b==a.m&&a.d.ka();a.Q[1]=window.setTimeout(function(){c.b==a.m&&(a.play(c.e,d),a.time(f,d))},3E3)},3E3)},d):(c.e?a.d.Ma():a.d.ka(),a.time(f,d));E.update()})})};a.time=function(b,c){if((b=0===b?1:b)&&5>Math.abs(b-a.time()))return b;b&&(a.h=b,c!=d?a.I():a.d.Hb(b,d));if((b>=a.length()||a.d.ya()>=a.length())&&a.e)a.e=e,a.h=0,E.update();
a.h=a.d.ya()||a.h;a.Ia=a.O(a.h);a.h&&t.c().z.time.set(a.h);E.f.fb(a.h);E.update();return a.h};a.I=function(){t.c().k.set({e:a.e,G:Date.now(),time:a.h,b:a.m});E.update()};a.volume=function(b){window.Ca(b)||a.d.Nb(b);return a.d.wb()}};var B={};n.j();E.j();D.j();var s={};
function m(a){a.hb=n;a.lb=t;a.Ib=C;a.P=D;a.S=E;if(n.H){a.Oa=function(b){var c=a.Ua.Sa;"$apply"==c||"$digest"==c?b&&"function"===typeof b&&b():a.Ta(b)};var b=E.update;E.update=function(c){b();a.Oa(c)};var c={},f=function(a,b,f){function h(c){a[b]=c.l();E.update()}c[f]=c[f]||h;return c[f]},h={},j=function(a,b){function c(b){a[b.name()]=b.l();E.update()}h[b]=h[b]||c;return h[b]};t.g().ba(500).o("child_added",function(a){j(t.data.g)(a);g.object.Z(t.data.g).wa("processed").forEach(function(a){var b=t.data.g[a],
c="track"+b;t.b(b).A("value",f(t.data.b,b,c));t.b(b).o("value",function(a){f(t.data.b,b,c)(a);t.data.g.B[b]=a.l()})})});t.c().o("value",function(a){f(t.data.c,n.s)(a);var b=t.data.c[n.s];if(b.F==e)t.c().F.set(d);else{for(var c in b.L){a=b.L[c];var h="group"+a,v=h+"members",w=h+"messages",h=h+"name",y=t.group(a).v().ba(500),z=t.group(a).w().ba(500),A=t.group(a).name;t.data.group[c]=t.data.group[c]||{v:{},w:{},name:""};y.A("child_added",j(t.data.group[a].v,v));y.o("child_added",j(t.data.group[a].v,
v));z.A("child_added",j(t.data.group[a].w,w));z.o("child_added",j(t.data.group[a].w,w));A.A("value",f(t.data.group[a],"name",h));A.o("value",f(t.data.group[a],"name",h))}b.i=b.i||{};b.i.B=b.i.B||{};g.object.Z(b.i).wa("processed").map(function(a){return b.i[a]}).add(b.k.b).unique().compact().forEach(function(a){var c="track"+a;t.b(a).A("value",f(t.data.b,a,c));t.b(a).o("value",function(h){f(t.data.b,a,c)(h);var j=h.l();j.id=a;j.length=D.O(j.length);j.g=(new Date(j.g)).pb("{12hr}{tt}, {yyyy}-{MM}-{dd}");
n.$(j.M,function(c){j.M=c;j.ga="";if(j.id==(D.m||b.k.b))j.ga="now-playing",b.Cb=j;b.i.B[a]=j;E.update();D.d.Qa&&!window.Da&&(window.Da=d,D.na())})})});t.data.c.X=b;window.ua=d;E.update()}})}};var C=new function(){var a=this;a.ea=function(a,c,f){a={U:"callback",type:"master",Na:a};c&&g.object.add(a,"artist",c);(new g.n.pa("http://api.discogs.com/database/search")).send(a,function(a){var b=[],c=[];(g.object.u(a,"data","results")||[]).slice(0,20).forEach(function(a){var f=(a.title||"").split("-"),h=f.slice(1).join("").trim(),f=f[0].split("(")[0].trim(),v=(a.D||[])[0];a=a.J;var w=n.hash(h+f+a);b.add({title:h,C:f,D:v,J:a,id:w});c.add(new g.async.K)});f(b,c)})};a.search=function(b,c,f){a.ea(b,
c,function(b,c){for(var r=g.async.Wa.rb(c),p=0;p<b.length;++p){var x=b[p];a.P(x.title,x.C,p,function(a,b){c[b].U(a,b)})}r.cb(function(a){function c(a){return a.p}a.forEach(function(a,c){var f=b[c];f.p=a.p;f.q=a.q;f.length=a.length});a=b.xa(c).unique(c).Pa(function(a){return a.q},d);a.forEach(function(a){var b=t.b(a.id);b.update({C:a.C,D:a.D,length:(a.length||0).R(),title:a.title,J:(a.J||42).R(),p:a.p,q:(a.q||0).R()});b.update({N:0})});f(a)})})};a.P=function(a,c,f,h){c=c.replace("Various","Song");
(new g.n.pa("http://gdata.youtube.com/feeds/api/videos")).send({U:"callback",alt:"json-in-script",Rb:2,Na:"{0} {1} {2}".assign({"0":a,1:c,2:[].reduce(function(f,h){var p=h.toLowerCase();return f+(!a.toLowerCase().aa(p)&&!c.toLowerCase().aa(p)?' -"{0}"'.assign({"0":p}):"")},"")})},function(a){if(!g.object.u(a,"feed","entry"))return h({},f);a=a.ob.mb.map(function(a){var b=(g.object.u(a,"id","$t")||"").split("video:")[1],c=(g.object.u(a,"yt$statistics","viewCount")||0).R(),f=g.object.u(a,"media$group",
"media$content",0,"duration"),h=((a.Sb||{}).find(function(a){return"embed"==a.action})||{}).Fb;a=g.object.u(a,"app$control","yt$state");return{p:b,q:c,length:f,Aa:!("allowed"!=h||a)}}).xa(function(a){return a.Aa}).slice(0,5).Pa(function(a){return a.q},d);h(a[0]||{},f)})}};var n=new function(){function a(a){return"{0}@firebase.com".assign({"0":a})}var b=this;b.j=function(){b.sa=5E6;b.H=g.n.t.get("napsterfm-token");b.s=g.n.t.get("napsterfm-userid");b.T=g.n.t.get("napsterfm-username");b.H&&(t.root.gb(b.H),t.c().F.set(d),t.c().F.ma(e))};b.$=function(a,b){t.c(a).T.ja("value",function(a){b(a.l().replace("@firebase.com",""))})};b.hash=function(a){return(new g.ta.Ya(new g.ta.ab,"napster")).ub(a).map(function(a){return a.toString(36)}).join("")};b.da=function(b){var f=new g.async.K;
(new FirebaseAuthClient(t.root)).da("password",a(b));return f};b.Ga=function(){t.root.Qb();g.n.t.remove("napsterfm-token");g.n.t.remove("napsterfm-userid");g.n.t.remove("napsterfm-username");document.location.reload(d)};b.W=function(b,f){var h=new g.async.K;(new FirebaseAuthClient(t.root)).W(a(b),f);return h};b.V=function(b,f,h){var j=new g.async.K;(new FirebaseAuthClient(t.root)).V(a(b),f,h);return j}};var E=new function(){var a=this;a.j=function(){window.onhashchange=function(){function a(b,c,j){b=F(b);for(var r=0;r<b.length;++r){var p=b[r];g.r.jb.enable(j?j(p):p,"active",p.getAttribute(c)==window.location.hash)}}a(".navbar a","href",function(a){return a.parentNode});a("[hash-location]","hash-location")};if(window.location.hash)window.onhashchange();else window.location.hash=F(".navbar li.active")[0].sb()[0].getAttribute("href");var b=new g.S.ra;b.Jb(g.S.ra.eb);b.va(F("#library-table")[0]);a.f=
new g.S.bb;a.f.Kb(d);a.f.Mb(d);a.f.onclick=function(){a.f.oa=d;D.time(a.f.vb());window.setTimeout(function(){a.f.oa=e},1E3)};a.f.va(F("#player .slider")[0])};a.update=function(){a.Ka=window.Ca(D.h)?"loading":"";a.La=D.e?"playing":"paused"}};var u=new function(){this.log=function(a){console.log(a)};this.Ea=function(){console.log("foo")};this.Fa=function(a){console.log(a.l())};this.Ha=function(a){t.c().i.push(a[0].id)}};var t=new function(){var a=this;a.data={group:{},g:{B:{}},b:{},c:{}};a.root=new Firebase("https://napsterfm.firebaseio.com/");a.group=function(b){b=(b||0).toString();var c=a.root.a("group").a(b);c.v=c.a("members");c.Bb=function(a){a=a.toString();return c.v.a(a)};c.w=c.a("messages");c.message=function(a){a=a.toString();a=c.w.a(a);a.ib=a.a("author");a.kb=a.a("created");a.text=a.a("text");return a};c.name=c.a("name");return c};a.g=function(){return a.root.a("lastPlayed")};a.b=function(b){b=b.toString();
b=a.root.a("track").a(b);b.C=b.a("artist");b.D=b.a("genre");b.g=b.a("lastPlayed");b.M=b.a("lastPlayedBy");b.length=b.a("length");b.N=b.a("playCount");b.title=b.a("title");b.J=b.a("year");b.p=b.a("youtubeid");b.q=b.a("youtubeviews");return b};a.c=function(b){b=(b||n.s).toString();var c=a.root.a("user").a(b);c.L=c.a("groups");c.group=function(a){a=a.toString();return c.L.a(a)};c.Y=c.a("following");c.za=c.a("hotlist");c.xb=function(a){a=a.toString();return c.za.a(a)};c.F=c.a("isOnline");c.k=c.a("nowPlaying");
c.z={e:c.k.a("isPlaying"),G:c.k.a("lastChange"),time:c.k.a("time"),b:c.k.a("track")};c.i=c.a("library");c.zb=function(a){a=a.toString();return c.i.a(a)};c.Ra=c.a("transfers");c.Ob=function(a){a=a.toString();a=c.Ra.a(a);a.qb=a.a("from");a.b=a.a("track");return a};c.T=c.a("username");return c}};var q={};function F(a){var b=g.r.Gb(a),c=1>b.length;c&&1>(new DOMParser).parseFromString(a,"text/xml").getElementsByTagName("parsererror").length?(c=g.r.createElement("div"),c.innerHTML=a,b[0]=c.firstChild):c&&(b[0]={});G.forEach(function(a){for(var c=0;c<b.length;++c)b[c][a]=b[c][a]||g.r[a].fill(b[c]);b[a]=b[0]&&b[0][a]});return b}var G=g.object.Z(g.r).filter(function(a){return!a.aa("_")&&"function"===typeof g.r[a]});G.forEach(function(a){F[a]=g.r[a]});
