var d=!0,f=!1,g=g||{},k=this;function l(a,b){var c=a.split("."),e=k;!(c[0]in e)&&e.execScript&&e.execScript("var "+c[0]);for(var h;c.length&&(h=c.shift());)!c.length&&void 0!==b?e[h]=b:e=e[h]?e[h]:e[h]={}};l("Napster",m);l("authentication.cookieAge",n.sa);l("authentication.token",n.H);l("authentication.userid",n.s);l("authentication.username",n.T);l("authentication.init",n.j);l("authentication.getUsername",n.$);l("authentication.hash",n.hash);l("authentication.login",n.da);l("authentication.logout",n.Ga);l("authentication.createUser",n.W);l("authentication.changePassword",n.V);l("datastore.data",q.data);l("datastore.root",q.root);l("datastore.group",q.group);l("datastore.lastPlayed",q.g);
l("datastore.track",q.b);l("datastore.user",q.c);l("debug.log",s.log);l("debug.logFoo",s.Ea);l("debug.logVal",s.Fa);l("debug.lucky",s.Ha);l("services.metadata",t.ea);l("services.search",t.search);l("services.stream",t.P);l("stream.isPlaying",u.e);l("stream.newTime",u.h);l("stream.newTimeProcessed",u.Ia);l("stream.player",u.d);l("stream.syncTimeouts",u.Q);l("stream.init",u.j);l("stream.isFinished",u.Ba);l("stream.length",u.length);l("stream.loadTrack",u.ca);l("stream.mute",u.fa);
l("stream.onFinished",u.ha);l("stream.play",u.play);l("stream.processTime",u.O);l("stream.sync",u.na);l("stream.time",u.time);l("stream.updateNowPlaying",u.I);l("stream.volume",u.volume);l("ui.pageLoadingClass",B.Ka);l("ui.playButtonClass",B.La);l("ui.slider",B.f);l("ui.init",B.j);l("ui.update",B.update);var u=new function(){var a=this;a.j=function(){function b(){}function c(a){(a=a.data==YT.qa.Za?window.ia:a.data==YT.qa.Xa?window.Ja:null)&&a();B.update()}function e(){var b=new g.async.Va(function(){return window.ua});b.Db=function(){a.ha()};b.start()}window.Eb=function(){a.d=new YT.$a(C("#stream")[0],{height:"390",width:"640",yb:"1",nb:{onReady:e,onStateChange:c,onError:b}})};q.c().z.e.ma(f);q.c().z.G.ma(0);a.Q=[]};a.Ba=function(){return a.time()>=a.length()};a.length=function(){return a.d.tb()};
a.ca=function(b,c,e){a.d.Qa();a.time(0,d);window.ia=function(){window.ia=null;window.setTimeout(function(){u.volume(0);a.time(0,d);a.play(d,d);q.b(a.m).length.set(a.length());c&&c()},2E3)};q.b(b).ja("value",function(c){var j=c.l();c=c.name();B.f.Lb(j.length);q.b(b).g.set(Date.now());q.b(b).M.set(n.s);q.g().push(c);a.d.Ab(j.p);a.m=b;e!=d&&(q.b(b).N.set(++j.N),a.I());c=q.data.c.X.i.B;for(var r in c)j=c[r],j.ga=j.id==a.m?"now-playing":""})};a.fa=function(b){b!=f?a.d.fa():a.d.Pb()};a.ha=function(b){window.Ja=
function(){a.play(f);window.clearInterval(B.f.la);b&&b()}};a.play=function(b,c){a.e=b==f?f:d;a.e?a.volume(100):a.volume(0);window.clearInterval(B.f.la);a.e&&(B.f.la=window.setInterval(function(){!B.f.oa&&a.e&&a.time()},500));a.e?a.d.Ma():a.d.ka();B.update();a.time();c!=d&&a.I()};a.O=function(a){a=a||0;return(60>a?"0:":"")+(10>a?"0":"")+([].add((new Date(0,0,0,0,0,a)).toLocaleTimeString().match(/[^0:].*/))[0]||0)};a.na=function(b){b=b||n.s;var c=q.c(b);q.c(q.data.c.X.Y).z.G.A();q.c().Y.set(b);c.z.G.o("value",
function(b){b=b.l();var h=(Date.now()-b)/1E3;c.k.ja("value",function(b){var c=b.l(),e=c.time+(c.e?h:0);c.b!=a.m?a.ca(c.b,function(){a.Q[0]=window.setTimeout(function(){c.b==a.m&&a.d.ka();a.Q[1]=window.setTimeout(function(){c.b==a.m&&(a.play(c.e,d),a.time(e,d))},3E3)},3E3)},d):(c.e?a.d.Ma():a.d.ka(),a.time(e,d));B.update()})})};a.time=function(b,c){if((b=0===b?1:b)&&5>Math.abs(b-a.time()))return b;b&&(a.h=b,c!=d?a.I():a.d.Hb(b,d));if((b>=a.length()||a.d.ya()>=a.length())&&a.e)a.e=f,a.h=0,B.update();
a.h=a.d.ya()||a.h;a.Ia=a.O(a.h);a.h&&q.c().z.time.set(a.h);B.f.fb(a.h);B.update();return a.h};a.I=function(){q.c().k.set({e:a.e,G:Date.now(),time:a.h,b:a.m});B.update()};a.volume=function(b){window.Ca(b)||a.d.Nb(b);return a.d.wb()}};n.j();B.j();u.j();function m(a){a.hb=n;a.lb=q;a.Ib=t;a.P=u;a.S=B;if(n.H){a.Oa=function(b){var c=a.Ua.Sa;"$apply"==c||"$digest"==c?b&&"function"===typeof b&&b():a.Ta(b)};var b=B.update;B.update=function(c){b();a.Oa(c)};var c={},e=function(a,b,e){function h(c){a[b]=c.l();B.update()}c[e]=c[e]||h;return c[e]},h={},j=function(a,b){function c(b){a[b.name()]=b.l();B.update()}h[b]=h[b]||c;return h[b]};q.g().ba(500).o("child_added",function(a){j(q.data.g)(a);g.object.Z(q.data.g).wa("processed").forEach(function(a){var b=q.data.g[a],
c="track"+b;q.b(b).A("value",e(q.data.b,b,c));q.b(b).o("value",function(a){e(q.data.b,b,c)(a);q.data.g.B[b]=a.l()})})});q.c().o("value",function(a){e(q.data.c,n.s)(a);var b=q.data.c[n.s];if(b.F==f)q.c().F.set(d);else{for(var c in b.L){a=b.L[c];var h="group"+a,v=h+"members",w=h+"messages",h=h+"name",y=q.group(a).v().ba(500),z=q.group(a).w().ba(500),A=q.group(a).name;q.data.group[c]=q.data.group[c]||{v:{},w:{},name:""};y.A("child_added",j(q.data.group[a].v,v));y.o("child_added",j(q.data.group[a].v,
v));z.A("child_added",j(q.data.group[a].w,w));z.o("child_added",j(q.data.group[a].w,w));A.A("value",e(q.data.group[a],"name",h));A.o("value",e(q.data.group[a],"name",h))}b.i=b.i||{};b.i.B=b.i.B||{};g.object.Z(b.i).wa("processed").map(function(a){return b.i[a]}).add(b.k.b).unique().compact().forEach(function(a){var c="track"+a;q.b(a).A("value",e(q.data.b,a,c));q.b(a).o("value",function(h){e(q.data.b,a,c)(h);var j=h.l();j.id=a;j.length=u.O(j.length);j.g=(new Date(j.g)).pb("{12hr}{tt}, {yyyy}-{MM}-{dd}");
n.$(j.M,function(c){j.M=c;j.ga="";if(j.id==(u.m||b.k.b))j.ga="now-playing",b.Cb=j;b.i.B[a]=j;B.update();u.d.Qa&&!window.Da&&(window.Da=d,u.na())})})});q.data.c.X=b;window.ua=d;B.update()}})}};var t=new function(){var a=this;a.ea=function(a,c,e){a={U:"callback",type:"master",Na:a};c&&g.object.add(a,"artist",c);(new g.n.pa("http://api.discogs.com/database/search")).send(a,function(a){var b=[],c=[];(g.object.u(a,"data","results")||[]).slice(0,20).forEach(function(a){var e=(a.title||"").split("-"),h=e.slice(1).join("").trim(),e=e[0].split("(")[0].trim(),v=(a.D||[])[0];a=a.J;var w=n.hash(h+e+a);b.add({title:h,C:e,D:v,J:a,id:w});c.add(new g.async.K)});e(b,c)})};a.search=function(b,c,e){a.ea(b,
c,function(b,c){for(var r=g.async.Wa.rb(c),p=0;p<b.length;++p){var x=b[p];a.P(x.title,x.C,p,function(a,b){c[b].U(a,b)})}r.cb(function(a){function c(a){return a.p}a.forEach(function(a,c){var e=b[c];e.p=a.p;e.q=a.q;e.length=a.length});a=b.xa(c).unique(c).Pa(function(a){return a.q},d);a.forEach(function(a){var b=q.b(a.id);b.update({C:a.C,D:a.D,length:(a.length||0).R(),title:a.title,J:(a.J||42).R(),p:a.p,q:(a.q||0).R()});b.update({N:0})});e(a)})})};a.P=function(a,c,e,h){c=c.replace("Various","Song");
(new g.n.pa("http://gdata.youtube.com/feeds/api/videos")).send({U:"callback",alt:"json-in-script",Rb:2,Na:"{0} {1} {2}".assign({"0":a,1:c,2:[].reduce(function(e,h){var p=h.toLowerCase();return e+(!a.toLowerCase().aa(p)&&!c.toLowerCase().aa(p)?' -"{0}"'.assign({"0":p}):"")},"")})},function(a){if(!g.object.u(a,"feed","entry"))return h({},e);a=a.ob.mb.map(function(a){var b=(g.object.u(a,"id","$t")||"").split("video:")[1],c=(g.object.u(a,"yt$statistics","viewCount")||0).R(),e=g.object.u(a,"media$group",
"media$content",0,"duration"),h=((a.Sb||{}).find(function(a){return"embed"==a.action})||{}).Fb;a=g.object.u(a,"app$control","yt$state");return{p:b,q:c,length:e,Aa:!("allowed"!=h||a)}}).xa(function(a){return a.Aa}).slice(0,5).Pa(function(a){return a.q},d);h(a[0]||{},e)})}};var n=new function(){function a(a){return"{0}@firebase.com".assign({"0":a})}var b=this;b.j=function(){b.sa=5E6;b.H=g.n.t.get("napsterfm-token");b.s=g.n.t.get("napsterfm-userid");b.T=g.n.t.get("napsterfm-username");b.H&&(q.root.gb(b.H),q.c().F.set(d),q.c().F.ma(f))};b.$=function(a,b){q.c(a).T.ja("value",function(a){b(a.l().replace("@firebase.com",""))})};b.hash=function(a){return(new g.ta.Ya(new g.ta.ab,"napster")).ub(a).map(function(a){return a.toString(36)}).join("")};b.da=function(b){var e=new g.async.K;
(new FirebaseAuthClient(q.root)).da("password",a(b));return e};b.Ga=function(){q.root.Qb();g.n.t.remove("napsterfm-token");g.n.t.remove("napsterfm-userid");g.n.t.remove("napsterfm-username");document.location.reload(d)};b.W=function(b,e){var h=new g.async.K;(new FirebaseAuthClient(q.root)).W(a(b),e);return h};b.V=function(b,e,h){var j=new g.async.K;(new FirebaseAuthClient(q.root)).V(a(b),e,h);return j}};var B=new function(){var a=this;a.j=function(){window.onhashchange=function(){function a(b,c,j){b=C(b);for(var r=0;r<b.length;++r){var p=b[r];g.r.jb.enable(j?j(p):p,"active",p.getAttribute(c)==window.location.hash)}}a(".navbar a","href",function(a){return a.parentNode});a("[hash-location]","hash-location")};if(window.location.hash)window.onhashchange();else window.location.hash=C(".navbar li.active")[0].sb()[0].getAttribute("href");var b=new g.S.ra;b.Jb(g.S.ra.eb);b.va(C("#library-table")[0]);a.f=
new g.S.bb;a.f.Kb(d);a.f.Mb(d);a.f.onclick=function(){a.f.oa=d;u.time(a.f.vb());window.setTimeout(function(){a.f.oa=f},1E3)};a.f.va(C("#player .slider")[0])};a.update=function(){a.Ka=window.Ca(u.h)?"loading":"";a.La=u.e?"playing":"paused"}};var s=new function(){this.log=function(a){console.log(a)};this.Ea=function(){console.log("foo")};this.Fa=function(a){console.log(a.l())};this.Ha=function(a){q.c().i.push(a[0].id)}};var q=new function(){var a=this;a.data={group:{},g:{B:{}},b:{},c:{}};a.root=new Firebase("https://napsterfm.firebaseio.com/");a.group=function(b){b=(b||0).toString();var c=a.root.a("group").a(b);c.v=c.a("members");c.Bb=function(a){a=a.toString();return c.v.a(a)};c.w=c.a("messages");c.message=function(a){a=a.toString();a=c.w.a(a);a.ib=a.a("author");a.kb=a.a("created");a.text=a.a("text");return a};c.name=c.a("name");return c};a.g=function(){return a.root.a("lastPlayed")};a.b=function(b){b=b.toString();
b=a.root.a("track").a(b);b.C=b.a("artist");b.D=b.a("genre");b.g=b.a("lastPlayed");b.M=b.a("lastPlayedBy");b.length=b.a("length");b.N=b.a("playCount");b.title=b.a("title");b.J=b.a("year");b.p=b.a("youtubeid");b.q=b.a("youtubeviews");return b};a.c=function(b){b=(b||n.s).toString();var c=a.root.a("user").a(b);c.L=c.a("groups");c.group=function(a){a=a.toString();return c.L.a(a)};c.Y=c.a("following");c.za=c.a("hotlist");c.xb=function(a){a=a.toString();return c.za.a(a)};c.F=c.a("isOnline");c.k=c.a("nowPlaying");
c.z={e:c.k.a("isPlaying"),G:c.k.a("lastChange"),time:c.k.a("time"),b:c.k.a("track")};c.i=c.a("library");c.zb=function(a){a=a.toString();return c.i.a(a)};c.Ra=c.a("transfers");c.Ob=function(a){a=a.toString();a=c.Ra.a(a);a.qb=a.a("from");a.b=a.a("track");return a};c.T=c.a("username");return c}};function C(a){var b=g.r.Gb(a),c=1>b.length;c&&1>(new DOMParser).parseFromString(a,"text/xml").getElementsByTagName("parsererror").length?(c=g.r.createElement("div"),c.innerHTML=a,b[0]=c.firstChild):c&&(b[0]={});D.forEach(function(a){for(var c=0;c<b.length;++c)b[c][a]=b[c][a]||g.r[a].fill(b[c]);b[a]=b[0]&&b[0][a]});return b}var D=g.object.Z(g.r).filter(function(a){return!a.aa("_")&&"function"===typeof g.r[a]});D.forEach(function(a){C[a]=g.r[a]});
